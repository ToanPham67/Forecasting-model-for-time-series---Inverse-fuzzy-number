clc
clear all
% so nguoi chet hang ngay
% V=[2	1	1	1	0	1	1	1	0	0	0	1	1	0	2	2	0	0	2	0	0	2	1	1	0	2	0	0	1	2	2	3	0	1	2	2	0	2	2	2	1	0	3	0	2	4	7	5	2	6	2	7	6	7	6	69	18	0	29	80	0	36	0	0	0	0	154	0	106	392	139	145	0 ...
%     0	765	256	393	296	234	147	360	388	342	326	275	349	337	367	331	298	380	390	0	737	389	348	335	318	386	352	344	315	0	804	270	308	347	281	311	316	434	335	275	273	261	381	276	250	239	212	220	233	215	240	236	236	203	180	184	174	178	162	203	136	164	114	130	134	119	125	114	105	113	115	93	106	81	93]';
% duongtinh VN
% cana=[	4	6	9	12	12	6	3	10	9	5	8	45	18	14	20	23	10	35	60	47	108	167	77	82	87	82	76	296	100	147	153	208	89 ...
%         132	178	156	129	527	155	270	40	512	199	325	193	245	193	301	216	211	236	195	413	200	213	289	293	251	423	490	356	358	470	280	272	252	207	334	214	788	415	396	371	545	675	394	1189	951	1051	1029	1044	1425	1798	1862	2008	2187	2744	2830	4049	4004	4710	4843	4335	5427	5537	7125	8688	7956	6260	5174	10774	6519	9765	7717	8938	7447	7445	16954	7295	7310	4315	12275	9904	9334	8043	8606	5025	9180	9716	9580	8652	9605	8800	10510	10657	13439 ...
%         11352	10397	10811	12096	11575	17428	12103	12796	14224	12607	11434	13197	14922	9521	13137	12481	14208	12680	12420	13321	11932	12026	11172	10508	10585	10489	11521	9373	10040	8681	11692	11527	9472	8537	9706	10011	9362	4589	8758	11357	6957]';
% Duong tinh Campuchia
% cana=[0	49	35	25	40	64	44	26	38	15	24	34	31	23	21	34	24	0	113	39	62	39	41	20	0	180	36	37	0	0	...
%     175	35	29	55	0	96	179	86	145	62	0	37	69	143	0	63	163	0	113	576	477	434	0	181	178	344	262	291	618	624 ...
%     431	303	446	655	511	616	580	508	698	880	761	388	730	841	938	672	650	558	538	520	506	480	472	446	358	335	350	360	345	393	... 
%     415	460	488	560	556	568	660	649	599	588	579	690	616	750	729	886	538	631	589	678	729	426	655	638	468	542	495	693	625	799	...
%     471	659	735	678	587	655	699	745	839	883	723	1130	999	966	948	993	896	935	981	954	988	933	981	911	830	915	996	889	836	845	...
%     790	825	812	811	825	860	819	778	685	766	765	668	658	671	560	577	583	591	588	522	556	508	499	486	455	423	598	588	593	556	593	533 ...
%     519	493	496	410	466	428	423	411	401	438	408	439	455	416	491	422	461	528	511	596	589	660	658	662	629	657	653	...
%     693	698	648	612	622	628	637	638	822	816	830	839	866	881	978	232]';

%Duong tinh Indo
cana=[433	292	349	395	484	367	338	336	533	387	233	484	689	568	490	529	489	496	486	693	973	634	949	526	479	415	686	687	678	557	700	467	609	684	585	703	993	672	847	1043	1240	979	1111	1014	857	1017	1106	1031	1331	1041	1226	862	954	1051	1113	1178	1240	1385	1198	1082	1293	1385	1624	1301	1447	1607	1209 ...
    1268	1853	2657	1611	1671	1681	1282	1591	1522	1574	1462	1752	1639	1693	1655	1882	1906	1761	1868	1492	1525	1748	2381	1904	2040	1560	1519	1679	1922	1815	1882	2473	2277	1893	1687	1693	1942	2098	2307	2345	2081	1821	1673	1902	2266	2197 ...
    2090	2037	1877	2447	2306	2719	3003	3308	2858	2743	2775	3075	3622	3269	3128	3444	2880	3046	3307	3861	3737	3806	3636	3141	3507	3963	3635	3891	4168	3989	4176	4071	4465	4634	4823	4494	3874	3509	4002	4284	4174	4317	4007	3992	3622	4056 ...
    4538	4850	4094	4294	4497	3267	3906	4127	4411	4301	4301	4105	3373	3602	4267	4432	4369	4070	3732	3222	3520	4029	3565	2897	3143	2696	2618	2973	3356	4065	3778	4262	3880	2853	3779	3770	4173	5444	5272	4106	3535	3807	4265	4798	4792	4998 ...
    4360	4442	4192	5534	4917	5828	5418	6267	4617	5092	5533	8369	5803	6027	6089	5754	5292	6058	6033	6310	6388	6189	5489	6120	6725	7354	6689	7751	6982	6848	6347	7514	7199	7259	6740	6528	5854	7903	8002	8074	8072	7203	6877	6753	7445	8854 ...
    9321	10617	10046	9640	8692	10047	11278	11557	12818	14224	11287	9086	10365	12568	11703	13632	12191	11788	9994	13094	11948	13695	13802	14518	12001	10994	10379	11984	11434	11749	12156	10827	8242	8700	8776	8435	9869	8844	6765	6462	10029	9687	9039	10614	8054	7300 ...
    10180	9775	7533	8493	8232	6208	5560	6680	5712	6808	7264	6971	5767	5826	6894	6389	5633	5144	6412	4607	4714	5589	5414	6825	6570	6279	5656	4396	5744	5297	5227	6107	4982	4461	4083	5008	4682	5937	6142	5325	4345	6731	3712	4549	4860	5504 ...
    5265	4723	4127	4829	5702	5656	6177	5363	5041	4585	4952	5549	5720	6243	5436	4544	4402	5944	4656	5241	5833	5500	4512	4394	4730	4369	5285	5647	6327	6130	3922	4891	5021	4608	3448	2633	2385	3080	4295	4185	4871	5797	5746	5296	5280	5907 ...
    5060	5034	6278	5862	6565	6115	5662	4824	5246	5353	6486	6594	5832	6993	6294	7725	8892	8083	7465	9868	8189	8161	9944	12624	12990	12906	13737	14536	13668	15308	20574	18872	21095	21342	20694	20467	21807	24836	25830	27913	27233	29745	31189	34379	38391	38124 ...
    35094	36197	40427	47899	54517	56757	54000	51952	44721	34257	38325	33772	49509	49071	45416	38679	28228	45203	47791	43479	41168	37284	30738	22404	33900	35867	35764	39532	31753	26415	20709	32081	30625	24709	30788	28598	20813	17384	20741	15768	22053	20004	16744	12408	9604	19106 ...
    18671	16899	12618	10050	7427	5436	10534	10337	0	16752	6727	5403	4413	7201	6731	5990	5376	5001	3779	2577	4128	3948	3145	3835	3385	2234	1932	3263	2720	2881	2557	2137	1760	1390	2057	1954	1690	1624]';

%Duong tinh Malyasia
% cana=[69	105	122	55	30	45	39	68	54	67	70	16	37	40	36	17	22	47	37	31	50	78	48	60	172	187	15	10	103	30	57	38	20	93	277	19	37	19	7	7	2	31	33	43	8	41	11	10	14	6	21	16	15	3	6	4	6	10	18	3	2	1	3	5	10	5	5	6	3	6	13	8	14	7	4	5	3	18	9	15	21	15	16	9	21	23	13	7	39	13	8	...
%     12	9	14	2	1	21	15	25	7	13	11	9	11	15	20	26	25	12	7	16	5	9	8	10	7	11	6	5	10	11	17	6	14	6	14	11	6	6	62	100	24	45	182	58	47	31	23	62	21	95	20	52	57	82	147	71	111	82	150	115	101	89	260	287	317	293	432	691	489	375	354	374	561	563	660	660	589	629	869	871	865	862	732	847	710	1228	823	1240	835	801 ...
%     649	799	659	957	834	1054	1032	1009	1755	1168	852	972	869	822	919	1304	1114	1208	1103	1210	660	1290	958	1041	1096	1884	2188	970	935	1109	1315	1309	1212	1472	851	1075	1141	1123	1335	1600	1012	959	2234	1810	1937	1229	1371	1772	1295	1220	1683	1153	1340	2018	...
%     2062	1348	1581	1247	2335	1196	1594	1925	1870	2525	2068	2295	1704	1741	2027	2593	3027	2643	2451	2433	2232	3309	2985	3337	3211	4029	3339	3306	3631	4008	3170	3631	4275	3346	3048	3585	3680	4094	5725	5728	5298	4214	3455	4284	4571	3391	... 
%     3847	3731	3100	2764	3288	3384	3318	3499	2464	2176	2720	2998	2712	2936	2461	3297	2192	2468	3545	1924	2253	2364	2437	1828	1555	1745	2063	2154	1680	1683	1529	1280	1448	1647	1575	1470	1354	1208	1063	1219	1213	1576	1671	1327	1116	1384	...
%     1268	1360	1275	1199	1302	941	1133	1482	1178	1294	1638	1349	1070	1300	1139	1285	1854	1510	1739	1317	1767	1889	2148	2551	2331	2195	2078	2341	2340	2875	2847	2717	2690	2776	2733	3142	3332	3788	2881	3418	2500	3120	3744	3551	4498	4519	3733 ...
%     3807	3973	4765	4855	4113	4140	3780	4446	4865	6075	6806	6493	6320	6976	6509	7289	7478	7857	8290	9020	6999	6824	7105	7703	8209	7748	7452	6241	5271	5566	6239	5671	6849	5793	5304	4949	5419	5150	5738	6440	5911	5293	4611	4743	5244	5841	5812 ...
%     5803	5586	5218	6437	6276	6988	6982	6658	6045	6387	7654	7097	8868	9180	9353	9105	8574	11079	11618	13215	12541	12528	10710	10972	12366	11985	13034	15573	15902	17045	14516	16117	17405	17170	16840	17786	17150	15764	17105	19819	20596	20889	19257	18688	17236	19991	20780 ...
%     21668	21468	20670	20546	19740	19631	22242	22948	23564	22262	19807	17672	20837	22642	24599	22070	22597	20579	19268	20897	18762	20988	19378	19057	20396	17352	18547	19733	19307	21176	19550	19198	16073	15669	19495	18815	17577	15549	14954	14345	15759	14990	13754	14554	13899	13104	10959 ...
%     11332	12434	12735	11889]';
%% NGUOI CHET
% cana=[3	7	3	1	3	4	0	0	6	6	5	5	6	5	0	3	4	2	3	5	1	2	9	3	4	7	4	2	7	6	5	6	10	6	6	10	11	3	12	11	11	11	9	15	13	13	7	12	14	20	17	10	...
%     18	16	18	16	14	17	16	19	27	26	32	36	24	28	31	19	27	30	26	21	23	28	33	39	27	24	30	22	21	19	20	34	32	29	22	19	15	11	25	22	23	22	29	17	19	19	11	25	23	17	12	20 ...
%     20	12	17	21	14	12	17	15	16	14	16	13	14	6	17	12	11	11	11	13	12	9	13	7	13	11	6	20	12	9	12	9	9	9	11	11	7	13	14	17	14	22	21	21	25	18	26	15	17	17	24	23 ...
%     23	12	13	10	18	23	24	21	17	15	25	26]';
% indo=[131	144	153	188	212	147	167	179	170	206	247	152	99	107	144	126	212	172	192	218	186	132	123	127	172	144	136	193	162	142	174	145	185	187	201	153	163	191	189	170	211	193	164	149	237	164	196	277	290	248	371 ...
%     294	335	303	355	422	358	409	423	463	467	504	539	493	555	558	728	1040	852	871	826	1007	891	864	991	982	1205	1092	1093	1338	1280	1383	1449	1566	1415	1266	1487	2069	1824 ...
%     1893	1759	1808	1604	1568	1598	1747	1739	1635	1588	1498	1475	2048	1579	1466	1432	1270	1222	1245	1180	1128	1492	1348	1361	1030	842	1038 ...
%     1041	889	599	591	551	568	532	653	0	1254	539	392	612	683	626	334	315	270	188	276	250	267	237	219	185	145	166	171	149	160	144	123	86	118	124	117	113	87	89	58	88	77	75	81	66	52	39	65	47	48	37	41]';
% Malay=[15	12	18	23	17	19	22	25	26	17	22	39	27	34	44	36	45	47	46	59	50	50	49	61	60	63	59	61	98	79	67	71	126	103	86	109	87	82	76	75	73	84	76	64	60	101	73	60	74	72	60	69 ...
%     77	83	84	82	81	60	57	107	62	84	73	107	63	77	103	91	135	77	87	90	103	125	118	110	115	138	153	129	93	199	134	144	184	92	207	207	143	174	134	165	160	219	195	257	164	160	210	360	212	201	211	318	277 ...
%     260	282	274	293	225	178	233	223	232	174	211	265	393	339	252	285	295	282	278	249	330	362	336	272	311	362	322	341	592	292	413	463	422	346	388	324	376	301	334	487	116	250	228	278	258	240	208	192	121	109	118	76	117	...
%     105	132	78	74	64	93	103	68	88	89]';
% VN=[2	1	1	1	0	1	1	1	0	0	0	1	1	0	2	2	0	0	2	0	0	2	1	1	0	2	0	0	1	2	2	3	0	1	2	2	0	2	2	2	1	0	3	0	2	4	7	5	2	6	2	7	6	7	6	69	18	0	29	80	0	36	0	0	0	0	154	0	106	392	139	145	0 ...
%     0	765	256	393	296	234	147	360	388	342	326	275	349	337	367	331	298	380	390	0	737	389	348	335	318	386	352	344	315	0	804	270	308	347	281	311	316	434	335	275	273	261	381	276	250	239	212	220	233	215	240	236	236	203	180	184	174	178	162	203	136	164	114	130	134	119	125	114	105	113	115	93	106	81	93]';
%% 
% cana=Malay;
h=round(80*length(cana)/100);
V=cana(1:h,:);
test=cana(h+1:end,:);
T = ((V(2:end,:)-(V(1:end-1,:)))./V(1:end-1,:))*100;
T(isinf(T)|isnan(T)) = 0
% chuanhoa=chuanhoa';
difference=T(2:end,:)-T(1:end-1,:);

% k=9
%======Phan tich chum===
% [du s]=fcm(difference,k);
% Zluu=[];
l=1;
zt=difference;
d = pdist2(zt,zt,'euclidean');
d1=triu(d,1);
cn=(size(zt,1)*(size(zt,1)-1))/2;
mu=(sum(sum(d1)))/(cn);
for i=1:size(zt,1)
   for j=1:size(zt,1)
     tong(i,j)=(d(i,j)-mu).^2;
    end
end
tt=triu(tong,1);
sigma=((sum(sum(tt)))/cn)^0.5;
f=[];
alp=ones(size(zt,1),size(zt,1));
for i=1:size(zt,1)
for j=1:size(zt,1)
    if d(i,j)>mu*alp(i,j)
       f(i,j)=0;
    else
       f(i,j)=exp(-d(i,j)/(sigma/l)); 
    end
end
end
for i=1:size(zt,1)
tu=0;
mau=0;
for j=1:size(zt,1)
    tu=tu+zt(j,:)*f(i,j);
    mau=mau+f(i,j);
end
ztmoi(i,:)=tu./mau;
end
ztmoi;
iter=0;
Zluu=[];
exilanh=0.001;
while max(max(abs(ztmoi-zt)))>exilanh 
    
    zt=ztmoi;
   iter=iter+1
%     
d=[];
% for i=1:size(zt,1)
% for j=1:size(zt,1)
% %    d(i,j)=(max(OLIDmain(zt(i,1:2),zt(j,1:2)),OLIDmain(zt(j,1:2),zt(i,1:2)))+max(OLIDmain(zt(i,3:4),zt(j,3:4)),OLIDmain(zt(j,3:4),zt(i,3:4))));
%  d(i,j)=hausdorff(zt(i,:),zt(j,:));
% %  d(i,j)=cityblock(zt(i,:),zt(j,:));
% end
% end
d = pdist2(zt,zt,'euclidean');
d;
d1=triu(d,1);
cn=(size(zt,1)*(size(zt,1)-1))/2;
mu=(sum(sum(d1)))/(cn);
tong=[];
for i=1:size(zt,1)
    for j=1:size(zt,1)
      tong(i,j)=(d(i,j)-mu).^2;
    end
end
tt=triu(tong,1);
sigma=((sum(sum(tt)))/cn)^0.5;
alp=alpha1(alp,f);
f=[];
for i=1:size(zt,1)
for j=1:size(zt,1)
     if d(i,j)>mu*alp(i,j)
       f(i,j)=0;  
     else
        f(i,j)=exp(-d(i,j)/(sigma/l)); 
    end
end
end
f;
for i=1:size(zt,1)
    tu=0;
    mau=0;
    for j=1:size(zt,1)
        tu=tu+zt(j,:)*f(i,j);
        mau=mau+f(i,j);
    end
  ztmoi(i,:)=tu/mau;
end
ztmoi;
% Zluu=[Zluu ztmoi];
end
% for i=1:length(ztmoi)
%     plot(1:iter,Zluu(i,:),'-o')
%     hold on 
%     title('The convergent plot of the AC algorithm')
% xlabel('The number of iteration')
% ylabel('The values')
% %legend('cluster 1','cluster 2','cluster 3','cluster 4','cluster 5')
% end
%==main===
% ztmoi=difference;
%cam k=7
% indo k=12
k=9;
[u,du]=kmeans(ztmoi,k);
%====du bao====
c=sort(du);
U1(1,:)=[c(1)-((c(2)-c(1))./2),(c(1)+c(2))./2];
Uk(k,:)=[(c(end-1)+c(end))/2, c(end)+(c(end)-c(end-1))/2];

for i=2:length(c)-1
    U(i,:)=[(c(i-1)+c(i))./2, (c(i)+c(i+1))./2];
end

Umoi=[U1;U(2:end,:);Uk(end,:)]

% for m=1:length(T)
for i=1:length(difference)
    for j=1:k
if Umoi(j,1)<difference(i,:)&& difference(i,:)<Umoi(j,2)
%    Uh(i,:) = Umoi(j,20)
    Tong(i)=0.0015/((0.0001/T(i))+ 1/(Umoi(j,2)+T(i)));
%     tt(i)=(Umoi(j,2)+T(i))
%     rr(m)=Umoi(j,1)
end
    end
end
% end
% one=ones(1,length(Tong))';
G=Tong';
F=V(3:end)+ (V(3:end).*G./100);
%===gia tri moi===
for j=1:k
    if Umoi(j,1)<difference(end,:) && difference(end,:)<Umoi(j,2)
        TL=.0015/((0.0001/T(end))+ 1/(Umoi(j,2)+T(end)));
    end
end
Vnew=V(end)+ (V(end)*TL/100);
Fn=[V(end); Vnew];
Tnew=T(end); 
T=[];
 Vn=[];
for t=1:105
    Vn=[Vn; Fn];
    T=[T; Tnew];
    [Fn, Tnew]=forecasting(Vn(end-1),Umoi,Vn(end),T(end));
    
end 
Vn;
hg=[F;Vn];
% MAPE=mean((abs(test-Vn)./test)*100)
% SMAPE=mean((abs(test'-Vn')/(abs(test')+abs(Vn')/2))*100)
% %MSE=mean((F(1:end,:)-V(3:end,:)).^2)
% MAE=mean(abs(abs(test-Vn)))
% % MAPE=mean((abs(V(3:end,:)-F)./V(3:end,:))*100)
%  figure
x=[1:length(cana)];
y=[1:length(hg)];
% % y=[1:25 ];
% plot(x,V','Color','red','LineStyle','-','linewidth',3)
% hold on
% plot(y,hg','Color','blue','LineStyle','--','linewidth',2)
ts1 = timeseries(cana,x);
ts1.Name = 'Daily Count';
ts1.TimeInfo.Units = 'days';
ts1.TimeInfo.StartDate = '1-May-2020';     
ts1.TimeInfo.Format = 'mmm dd, yy';               
plot(ts1,'r-','linewidth',2)
hold on
ts2 = timeseries(hg,y);
ts2.Name = 'Daily Count';
ts2.TimeInfo.Units = 'days';
ts2.TimeInfo.StartDate = '2-May-2020';    
ts2.TimeInfo.Format = 'mmm dd, yy';       
plot(ts2,'b-','linewidth',2)
xlabel('Date')
ylabel('Number of Infected People')
legend('Actual value','Forecasting')
hold off
% % axes('position',[.65 .175 .25 .25])
% % box on % put box around new pair of axes
% % plot(ts2.Time(517:end,:),ts2.Data(517:end,:),'r--','linewidth',2)



